# 需求文档 - 随机暂停功能

## 概述
在音乐播放过程中，歌曲播放完成后不立即播放下一首，而是随机暂停一段时间。暂停时长在用户配置的时间范围内随机选取。此功能可让播放更加自然，避免连续播放带来的单调感。

## 用户角色
- **普通用户**：创建和管理播放任务，配置随机暂停参数

## 功能需求

### FR-1: 随机暂停配置
**用户故事：** 作为普通用户，我想要为每个任务配置随机暂停的时间范围，以便控制歌曲之间的间隔时长

**验收标准：**
1. When 用户编辑任务时, the system shall 显示随机暂停配置选项
2. When 用户开启随机暂停功能时, the system shall 显示最小暂停时间和最大暂停时间的输入项
3. When 用户设置暂停时间范围时, the system shall 允许设置1-30分钟范围内的任意值
4. If 用户设置的最小时间大于最大时间, then the system shall 提示错误并阻止保存
5. When 用户关闭随机暂停功能时, the system shall 隐藏时间范围配置项
6. When 任务保存时, the system shall 持久化随机暂停配置（开关状态、最小时间、最大时间）

### FR-2: 随机暂停执行
**用户故事：** 作为普通用户，我想要在歌曲播放完成后自动暂停一段随机时间，以便让播放更加自然

**验收标准：**
1. When 一首歌曲播放完成且随机暂停功能已开启时, the system shall 在配置的时间范围内随机选取一个暂停时长
2. While 处于随机暂停期间, the system shall 不播放任何音频
3. When 随机暂停时间结束时, the system shall 自动播放下一首歌曲
4. When 随机暂停功能关闭时, the system shall 歌曲播放完成后立即播放下一首（保持原有行为）
5. While 处于随机暂停期间, the system shall 保持前台服务运行，不被系统杀死

### FR-3: 暂停状态UI显示
**用户故事：** 作为普通用户，我想要在界面上看到当前的暂停状态和剩余时间，以便了解播放进度

**验收标准：**
1. While 处于随机暂停期间, the system shall 在任务卡片上显示"暂停中"状态
2. While 处于随机暂停期间, the system shall 显示剩余暂停时间（格式：还剩 X:XX）
3. When 剩余时间变化时, the system shall 每秒更新一次显示
4. When 暂停结束开始播放时, the system shall 恢复显示正常的播放状态和进度

### FR-4: 暂停期间手动控制
**用户故事：** 作为普通用户，我想要在暂停期间手动控制播放，以便跳过等待时间

**验收标准：**
1. When 用户在暂停期间点击播放按钮时, the system shall 立即结束暂停并播放下一首歌曲
2. When 用户在暂停期间点击停止按钮时, the system shall 停止任务播放
3. When 用户在暂停期间点击暂停按钮时, the system shall 保持当前暂停状态（无变化）

## 非功能需求

### NFR-1: 性能要求
- 随机暂停计时器精度：误差不超过1秒
- UI更新频率：每秒1次
- 内存占用：暂停期间不应增加额外内存消耗

### NFR-2: 兼容性要求
- 支持所有三种播放模式：单曲播放、随机播放、循环列表
- 兼容现有的任务调度机制
- 兼容华为设备的后台运行限制

### NFR-3: 数据持久化
- 随机暂停配置需持久化到数据库
- 应用重启后配置不丢失

## 边界条件和异常处理
- **任务结束时间到达**：如果在随机暂停期间任务结束时间到达，应立即停止任务，不再播放下一首
- **设备休眠**：暂停期间设备休眠后，计时器应继续正常工作
- **应用被杀死**：如果应用在暂停期间被杀死，重启后不恢复暂停状态，按正常流程重新调度任务
- **蓝牙断开**：如果在暂停期间蓝牙断开（仅蓝牙输出任务），应停止任务

## 数据模型变更

### TaskEntity 新增字段
| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| randomPauseEnabled | boolean | false | 是否启用随机暂停 |
| minPauseMinutes | int | 2 | 最小暂停时间（分钟） |
| maxPauseMinutes | int | 6 | 最大暂停时间（分钟） |
