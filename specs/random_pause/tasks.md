# 实施计划 - 随机暂停功能

## 实施概览
预计总工时：6-8小时
关键里程碑：
1. 数据层完成（TaskEntity + 数据库迁移）
2. 服务层完成（TaskPlayer 暂停逻辑）
3. UI层完成（配置界面 + 状态显示）

## 任务列表

### 1. 数据层实现

- [x] 1.1 TaskEntity 新增字段
- [x] 1.2 数据库迁移

### 2. 服务层实现

- [x] 2.1 扩展 PlaybackState 类
- [x] 2.2 TaskPlayer 暂停逻辑实现
- [x] 2.3 更新 getPlaybackState() 方法
- [x] 2.4 添加 skipRandomPause() 公开方法

### 3. UI层 - 配置界面

- [x] 3.1 添加字符串资源
- [x] 3.2 修改任务编辑布局
- [x] 3.3 TaskEditActivity 配置逻辑

### 4. UI层 - 状态显示

- [x] 4.1 修改任务卡片布局（如需要）
- [x] 4.2 TaskAdapter 暂停状态显示
- [x] 4.3 MainActivity 跳过暂停处理

### 5. 边界条件处理

- [x] 5.1 任务结束时间检查
- [x] 5.2 蓝牙断开处理

### 6. 测试验证

- [x] 6.1 功能测试

## 依赖关系
```
1.1 → 1.2 → 2.1 → 2.2 → 2.3 → 2.4
                ↓
3.1 → 3.2 → 3.3
                ↓
        4.1 → 4.2 → 4.3
                ↓
            5.1 → 5.2
                ↓
               6.1
```

## 实施顺序建议
1. 先完成数据层（1.1, 1.2），确保数据模型正确
2. 再完成服务层核心逻辑（2.1-2.4）
3. 然后完成配置界面（3.1-3.3）
4. 接着完成状态显示（4.1-4.3）
5. 最后处理边界条件（5.1-5.2）
6. 全面测试（6.1）

## 风险点
- **数据库迁移**：确保迁移脚本正确，避免数据丢失
- **定时器精度**：Handler 在设备休眠时可能不准确，但前台服务有 WakeLock 保护
- **状态同步**：确保 UI 状态与服务状态一致
